;===============================================================================
; Dialplan Configuration for Translation Service
;===============================================================================

[general]
static=yes
writeprotect=no
clearglobalvars=no

;===============================================================================
; Translation Context
;===============================================================================

[translation-context]
; Translation conference entry point
; Format: Dial extension to join translation conference
exten => _XXXX,1,NoOp(Translation call for conference ${EXTEN})
  same => n,Answer()
  same => n,Set(CONFERENCE_ID=translation_${EXTEN})
  same => n,Verbose(1,Joining conference: ${CONFERENCE_ID})
  same => n,ConfBridge(${CONFERENCE_ID},translation_bridge,translation_user)
  same => n,Hangup()

; ExternalMedia channel entry point
exten => _EXXX.,1,NoOp(ExternalMedia translation channel ${EXTEN})
  same => n,Answer()
  same => n,Set(CHANNEL_ID=${EXTEN})
  same => n,Set(PIPE_TO=/tmp/asterisk_media/${CHANNEL_ID}_to_asterisk.pcm)
  same => n,Set(PIPE_FROM=/tmp/asterisk_media/${CHANNEL_ID}_from_asterisk.pcm)
  same => n,Verbose(1,ExternalMedia pipes: ${PIPE_TO}, ${PIPE_FROM})
  same => n,ExternalMedia(${PIPE_TO},${PIPE_FROM},slin16)
  same => n,Set(CONFERENCE_ID=${CUT(EXTEN,_,1)})
  same => n,ConfBridge(${CONFERENCE_ID},translation_bridge,translation_user)
  same => n,Hangup()

; Test echo extension
exten => 8888,1,NoOp(Echo test)
  same => n,Answer()
  same => n,Playback(hello-world)
  same => n,Echo()
  same => n,Hangup()

; Status extension
exten => 9999,1,NoOp(System status)
  same => n,Answer()
  same => n,Playback(welcome)
  same => n,Hangup()

;===============================================================================
; ExternalMedia Context
;===============================================================================

[externalmedia-context]
; Direct ExternalMedia channel access
exten => _X.,1,NoOp(ExternalMedia direct access: ${EXTEN})
  same => n,Answer()
  same => n,Set(PIPE_TO=/tmp/asterisk_media/${EXTEN}_to_asterisk.pcm)
  same => n,Set(PIPE_FROM=/tmp/asterisk_media/${EXTEN}_from_asterisk.pcm)
  same => n,ExternalMedia(${PIPE_TO},${PIPE_FROM},slin16)
  same => n,Hangup()
