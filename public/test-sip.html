<!DOCTYPE html>
<html>
<head>
    <title>SIP.js Integration Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .pass { color: #0f0; }
        .fail { color: #f00; }
        #results { margin-top: 20px; }
        .test { padding: 5px; margin: 5px 0; }
    </style>
</head>
<body>
    <h1>üß™ SIP.js Integration Test</h1>
    <div id="results"></div>

    <script type="module">
        const results = document.getElementById('results');

        function log(message, pass = true) {
            const div = document.createElement('div');
            div.className = 'test ' + (pass ? 'pass' : 'fail');
            div.textContent = (pass ? '‚úÖ ' : '‚ùå ') + message;
            results.appendChild(div);
        }

        // Test 1: Check if module import works
        log('Starting tests...');

        try {
            // Import SimpleUser from local npm package
            const { SimpleUser } = await import('/node_modules/sip.js/lib/platform/web/simple-user/simple-user.js');

            log('‚úì SIP.js module imported successfully');

            // Test 2: Check if SimpleUser class exists
            if (typeof SimpleUser === 'function') {
                log('‚úì SimpleUser class is available');

                // Test 3: Expose to global window
                window.SimpleUser = SimpleUser;
                log('‚úì SimpleUser exposed to window object');

                // Test 4: Verify it's accessible globally
                if (typeof window.SimpleUser !== 'undefined') {
                    log('‚úì window.SimpleUser is accessible');

                    // Test 5: Try to create instance (will fail without config, but proves class works)
                    try {
                        const testUser = new SimpleUser('wss://test.example.com/ws');
                        log('‚úì SimpleUser constructor works');
                    } catch (e) {
                        // Expected to fail without real server
                        log('‚úì SimpleUser constructor callable (error expected: ' + e.message + ')');
                    }

                    log('');
                    log('üéâ ALL TESTS PASSED - SIP.js integration is working!', true);

                } else {
                    log('‚úó window.SimpleUser not accessible', false);
                }
            } else {
                log('‚úó SimpleUser is not a function: ' + typeof SimpleUser, false);
            }

        } catch (error) {
            log('‚úó Failed to import SIP.js: ' + error.message, false);
            log('Error details: ' + error.stack, false);
        }
    </script>

    <!-- Test audio transport too -->
    <script src="/js/audio-transport.js?v=20251015-02"></script>
    <script>
        setTimeout(() => {
            const div = document.createElement('div');
            div.className = 'test';
            div.style.marginTop = '20px';
            div.style.borderTop = '1px solid #0f0';
            div.style.paddingTop = '10px';

            // Test AudioTransport class
            if (typeof AudioTransport !== 'undefined') {
                div.innerHTML = '‚úÖ AudioTransport class loaded<br>';

                try {
                    const transport = new AudioTransport('webrtc');
                    div.innerHTML += '‚úÖ AudioTransport WebRTC instance created<br>';
                } catch (e) {
                    div.innerHTML += '‚ùå AudioTransport WebRTC failed: ' + e.message + '<br>';
                }

                try {
                    const sipTransport = new AudioTransport('sip');
                    div.innerHTML += '‚úÖ AudioTransport SIP instance created<br>';
                } catch (e) {
                    div.innerHTML += '‚ùå AudioTransport SIP failed: ' + e.message + '<br>';
                }

            } else {
                div.innerHTML = '‚ùå AudioTransport class NOT loaded';
            }

            results.appendChild(div);
        }, 1000);
    </script>
</body>
</html>
