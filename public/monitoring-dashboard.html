<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Translation System - Monitoring Dashboard</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a2e;
            color: #eee;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .status-operational {
            background: #51cf66;
            color: white;
        }

        .status-degraded {
            background: #fcc419;
            color: #000;
        }

        .status-down {
            background: #ff6b6b;
            color: white;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #2a3f5f;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2a3f5f;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .service-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .icon-deepgram {
            background: #ff6b6b;
        }

        .icon-deepl {
            background: #4dabf7;
        }

        .icon-elevenlabs {
            background: #a78bfa;
        }

        .icon-hume {
            background: #51cf66;
        }

        .icon-system {
            background: #667eea;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #2a3f5f;
        }

        .metric-row:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #aaa;
            font-size: 0.95em;
        }

        .metric-value {
            font-size: 1.4em;
            font-weight: bold;
        }

        .metric-value.good {
            color: #51cf66;
        }

        .metric-value.warning {
            color: #fcc419;
        }

        .metric-value.critical {
            color: #ff6b6b;
        }

        .chart-container {
            position: relative;
            height: 200px;
            margin-top: 15px;
        }

        .large-chart {
            height: 300px;
        }

        .pipeline-viz {
            background: #0f1419;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .pipeline-step {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            padding: 10px;
            background: #16213e;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .pipeline-step.active {
            background: linear-gradient(90deg, #667eea, #764ba2);
            box-shadow: 0 0 20px rgba(102,126,234,0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(102,126,234,0.5); }
            50% { box-shadow: 0 0 30px rgba(102,126,234,0.8); }
        }

        .pipeline-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            margin-right: 15px;
            background: #2a3f5f;
        }

        .pipeline-step.active .pipeline-icon {
            background: white;
            color: #667eea;
        }

        .pipeline-info {
            flex: 1;
        }

        .pipeline-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .pipeline-latency {
            font-size: 0.9em;
            color: #aaa;
        }

        .pipeline-step.active .pipeline-latency {
            color: white;
            font-weight: bold;
        }

        .participants-list {
            margin-top: 15px;
        }

        .participant {
            display: flex;
            align-items: center;
            padding: 12px;
            background: #0f1419;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .participant-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .participant-info {
            flex: 1;
        }

        .participant-name {
            font-weight: bold;
            margin-bottom: 3px;
        }

        .participant-lang {
            font-size: 0.85em;
            color: #aaa;
        }

        .participant-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #51cf66;
            box-shadow: 0 0 10px #51cf66;
        }

        .participant-status.speaking {
            background: #ff6b6b;
            box-shadow: 0 0 10px #ff6b6b;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .emotion-viz {
            margin-top: 15px;
        }

        .emotion-bar {
            margin-bottom: 15px;
        }

        .emotion-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .emotion-progress {
            height: 8px;
            background: #2a3f5f;
            border-radius: 10px;
            overflow: hidden;
        }

        .emotion-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
        }

        .latency-breakdown {
            margin-top: 15px;
        }

        .latency-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }

        .latency-bar-container {
            flex: 1;
            height: 30px;
            background: #0f1419;
            border-radius: 6px;
            overflow: hidden;
            margin-left: 10px;
            position: relative;
        }

        .latency-bar {
            height: 100%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            font-size: 0.85em;
        }

        .latency-asr {
            background: #ff6b6b;
        }

        .latency-mt {
            background: #4dabf7;
        }

        .latency-tts {
            background: #a78bfa;
        }

        .latency-hume {
            background: #51cf66;
        }

        .quota-card {
            background: #16213e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .quota-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .quota-service {
            font-weight: bold;
        }

        .quota-percent {
            font-size: 1.2em;
        }

        .quota-bar {
            height: 6px;
            background: #2a3f5f;
            border-radius: 10px;
            overflow: hidden;
        }

        .quota-fill {
            height: 100%;
            transition: width 0.5s ease;
        }

        .quota-fill.low {
            background: #51cf66;
        }

        .quota-fill.medium {
            background: #fcc419;
        }

        .quota-fill.high {
            background: #ff6b6b;
        }

        .alert {
            background: #ff6b6b;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideDown 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-icon {
            font-size: 1.5em;
        }

        .controls {
            background: #16213e;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95em;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102,126,234,0.4);
        }

        .btn-secondary {
            background: #2a3f5f;
            color: white;
        }

        .btn-secondary:hover {
            background: #3a5f8f;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #aaa;
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #2a3f5f;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .timestamp {
            color: #aaa;
            font-size: 0.85em;
            margin-top: 10px;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .badge-success {
            background: #51cf66;
            color: white;
        }

        .badge-warning {
            background: #fcc419;
            color: #000;
        }

        .badge-error {
            background: #ff6b6b;
            color: white;
        }

        .full-width {
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéØ Real-Time Translation Monitoring Dashboard</h1>
        <p>Live system metrics and third-party service monitoring</p>
        <span class="status-badge status-operational" id="systemStatus">‚ö° System Operational</span>
    </div>

    <div class="container">
        <div id="alerts"></div>

        <div class="controls">
            <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ Refresh Data</button>
            <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
                <span id="autoRefreshBtn">‚è∏Ô∏è Pause Auto-Refresh</span>
            </button>
            <button class="btn btn-secondary" onclick="exportMetrics()">üìä Export Metrics</button>
            <button class="btn btn-secondary" onclick="window.open('/hmlcp-demo.html', '_blank')">üìñ View System Flow</button>
        </div>

        <div class="grid">
            <!-- Deepgram Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="service-icon icon-deepgram">üéôÔ∏è</div>
                        <div>
                            <div>Deepgram (ASR)</div>
                            <div style="font-size: 0.7em; color: #aaa;">Speech Recognition</div>
                        </div>
                    </div>
                    <span class="status-badge status-operational" id="deepgramStatus">‚úì OK</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Entry Point</span>
                    <span class="metric-value" style="font-size: 0.8em;">asr-streaming-worker:178</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Latency (p95)</span>
                    <span class="metric-value good" id="deepgramLatency">240ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Requests/min</span>
                    <span class="metric-value" id="deepgramRequests">45</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value good" id="deepgramErrors">0.5%</span>
                </div>
                <div class="chart-container">
                    <canvas id="deepgramChart"></canvas>
                </div>
            </div>

            <!-- DeepL Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="service-icon icon-deepl">üåê</div>
                        <div>
                            <div>DeepL (MT)</div>
                            <div style="font-size: 0.7em; color: #aaa;">Machine Translation</div>
                        </div>
                    </div>
                    <span class="status-badge status-operational" id="deeplStatus">‚úì OK</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Entry Point</span>
                    <span class="metric-value" style="font-size: 0.8em;">deepl-incremental-mt:245</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Latency (p95)</span>
                    <span class="metric-value good" id="deeplLatency">190ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Cache Hit Rate</span>
                    <span class="metric-value good" id="deeplCacheHit">65%</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value good" id="deeplErrors">0.2%</span>
                </div>
                <div class="chart-container">
                    <canvas id="deeplChart"></canvas>
                </div>
            </div>

            <!-- ElevenLabs Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="service-icon icon-elevenlabs">üó£Ô∏è</div>
                        <div>
                            <div>ElevenLabs (TTS)</div>
                            <div style="font-size: 0.7em; color: #aaa;">Text-to-Speech</div>
                        </div>
                    </div>
                    <span class="status-badge status-operational" id="elevenlabsStatus">‚úì OK</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Entry Point</span>
                    <span class="metric-value" style="font-size: 0.8em;">elevenlabs-tts-service:215</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Latency (p95)</span>
                    <span class="metric-value good" id="elevenlabsLatency">245ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Requests/min</span>
                    <span class="metric-value" id="elevenlabsRequests">40</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value good" id="elevenlabsErrors">0.8%</span>
                </div>
                <div class="chart-container">
                    <canvas id="elevenlabsChart"></canvas>
                </div>
            </div>

            <!-- Hume AI Service -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <div class="service-icon icon-hume">üòä</div>
                        <div>
                            <div>Hume AI (EVI)</div>
                            <div style="font-size: 0.7em; color: #aaa;">Emotion Analysis</div>
                        </div>
                    </div>
                    <span class="status-badge status-operational" id="humeStatus">‚úì OK</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Entry Point</span>
                    <span class="metric-value" style="font-size: 0.8em;">hume-evi-adapter:165</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Latency (p95)</span>
                    <span class="metric-value good" id="humeLatency">195ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Requests/min</span>
                    <span class="metric-value" id="humeRequests">60</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Error Rate</span>
                    <span class="metric-value good" id="humeErrors">0.3%</span>
                </div>
                <div class="chart-container">
                    <canvas id="humeChart"></canvas>
                </div>
            </div>
        </div>

        <!-- End-to-End Latency -->
        <div class="card full-width">
            <div class="card-header">
                <div class="card-title">
                    <div class="service-icon icon-system">‚ö°</div>
                    <span>End-to-End Translation Latency</span>
                </div>
                <span class="metric-value good" id="e2eLatency">875ms</span>
            </div>
            <div class="latency-breakdown">
                <div class="latency-item">
                    <span style="width: 100px;">ASR (Deepgram)</span>
                    <div class="latency-bar-container">
                        <div class="latency-bar latency-asr" id="latencyBarAsr" style="width: 27%;">240ms</div>
                    </div>
                </div>
                <div class="latency-item">
                    <span style="width: 100px;">MT (DeepL)</span>
                    <div class="latency-bar-container">
                        <div class="latency-bar latency-mt" id="latencyBarMt" style="width: 21%;">190ms</div>
                    </div>
                </div>
                <div class="latency-item">
                    <span style="width: 100px;">TTS (ElevenLabs)</span>
                    <div class="latency-bar-container">
                        <div class="latency-bar latency-tts" id="latencyBarTts" style="width: 27%;">245ms</div>
                    </div>
                </div>
                <div class="latency-item">
                    <span style="width: 100px;">Network</span>
                    <div class="latency-bar-container">
                        <div class="latency-bar" style="background: #667eea; width: 20%;">180ms</div>
                    </div>
                </div>
                <div class="latency-item">
                    <span style="width: 100px;">Hume (Parallel)</span>
                    <div class="latency-bar-container">
                        <div class="latency-bar latency-hume" id="latencyBarHume" style="width: 22%;">195ms (non-blocking)</div>
                    </div>
                </div>
            </div>
            <div class="chart-container large-chart">
                <canvas id="e2eChart"></canvas>
            </div>
        </div>

        <div class="grid">
            <!-- Audio Pipeline -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>üéµ Audio Processing Pipeline</span>
                    </div>
                </div>
                <div class="pipeline-viz">
                    <div class="pipeline-step active">
                        <div class="pipeline-icon">üì•</div>
                        <div class="pipeline-info">
                            <div class="pipeline-name">Frame Collector</div>
                            <div class="pipeline-latency">< 1ms ¬∑ 640 bytes @ 20ms</div>
                        </div>
                    </div>
                    <div class="pipeline-step">
                        <div class="pipeline-icon">üéØ</div>
                        <div class="pipeline-info">
                            <div class="pipeline-name">Prosodic Segmenter</div>
                            <div class="pipeline-latency">~3ms ¬∑ VAD + Boundaries</div>
                        </div>
                    </div>
                    <div class="pipeline-step">
                        <div class="pipeline-icon">üìä</div>
                        <div class="pipeline-info">
                            <div class="pipeline-name">Pacing Governor</div>
                            <div class="pipeline-latency">< 1ms ¬∑ Strict 20ms cadence</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Active Participants -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>üë• Active Participants</span>
                    </div>
                    <span class="metric-value" id="participantCount">0</span>
                </div>
                <div class="participants-list" id="participantsList">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Waiting for participants...</div>
                    </div>
                </div>
            </div>

            <!-- Emotion Analysis -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>üòä Real-Time Emotion Detection</span>
                    </div>
                </div>
                <div class="emotion-viz">
                    <div class="emotion-bar">
                        <div class="emotion-label">
                            <span>Arousal</span>
                            <span id="emotionArousal">0.50</span>
                        </div>
                        <div class="emotion-progress">
                            <div class="emotion-fill" id="emotionArousalBar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-label">
                            <span>Valence</span>
                            <span id="emotionValence">0.00</span>
                        </div>
                        <div class="emotion-progress">
                            <div class="emotion-fill" id="emotionValenceBar" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-label">
                            <span>Energy</span>
                            <span id="emotionEnergy">0.50</span>
                        </div>
                        <div class="emotion-progress">
                            <div class="emotion-fill" id="emotionEnergyBar" style="width: 50%;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- API Quota Usage -->
            <div class="card">
                <div class="card-header">
                    <div class="card-title">
                        <span>üìä API Quota Usage (Monthly)</span>
                    </div>
                </div>
                <div class="quota-card">
                    <div class="quota-header">
                        <span class="quota-service">Deepgram</span>
                        <span class="quota-percent" id="quotaDeepgram">10.4%</span>
                    </div>
                    <div class="quota-bar">
                        <div class="quota-fill low" style="width: 10.4%;"></div>
                    </div>
                </div>
                <div class="quota-card">
                    <div class="quota-header">
                        <span class="quota-service">DeepL</span>
                        <span class="quota-percent" id="quotaDeepl">25.0%</span>
                    </div>
                    <div class="quota-bar">
                        <div class="quota-fill medium" style="width: 25%;"></div>
                    </div>
                </div>
                <div class="quota-card">
                    <div class="quota-header">
                        <span class="quota-service">ElevenLabs</span>
                        <span class="quota-percent" id="quotaElevenlabs">32.0%</span>
                    </div>
                    <div class="quota-bar">
                        <div class="quota-fill medium" style="width: 32%;"></div>
                    </div>
                </div>
                <div class="quota-card">
                    <div class="quota-header">
                        <span class="quota-service">Hume AI</span>
                        <span class="quota-percent" id="quotaHume">45.0%</span>
                    </div>
                    <div class="quota-bar">
                        <div class="quota-fill medium" style="width: 45%;"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="timestamp" id="lastUpdate">Last updated: Never</div>
    </div>

    <script>
        // Socket.IO connection
        const socket = io();

        // Auto-refresh state
        let autoRefresh = true;
        let autoRefreshInterval;

        // Charts
        let charts = {};

        // Initialize dashboard
        function initDashboard() {
            createCharts();
            startAutoRefresh();
            subscribeToEvents();
            refreshDashboard();
        }

        // Create all charts
        function createCharts() {
            const chartConfig = (label, color) => ({
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: label,
                        data: [],
                        borderColor: color,
                        backgroundColor: color + '20',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: { display: false },
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#aaa' },
                            grid: { color: '#2a3f5f' }
                        }
                    }
                }
            });

            charts.deepgram = new Chart(
                document.getElementById('deepgramChart'),
                chartConfig('Latency (ms)', '#ff6b6b')
            );

            charts.deepl = new Chart(
                document.getElementById('deeplChart'),
                chartConfig('Latency (ms)', '#4dabf7')
            );

            charts.elevenlabs = new Chart(
                document.getElementById('elevenlabsChart'),
                chartConfig('Latency (ms)', '#a78bfa')
            );

            charts.hume = new Chart(
                document.getElementById('humeChart'),
                chartConfig('Latency (ms)', '#51cf66')
            );

            // E2E Chart
            charts.e2e = new Chart(
                document.getElementById('e2eChart'),
                {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [
                            {
                                label: 'Total Latency',
                                data: [],
                                borderColor: '#667eea',
                                backgroundColor: '#667eea20',
                                fill: true,
                                tension: 0.4
                            },
                            {
                                label: 'Target (900ms)',
                                data: [],
                                borderColor: '#ff6b6b',
                                borderDash: [5, 5],
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                labels: { color: '#eee' }
                            }
                        },
                        scales: {
                            x: {
                                ticks: { color: '#aaa' },
                                grid: { color: '#2a3f5f' }
                            },
                            y: {
                                beginAtZero: true,
                                max: 1200,
                                ticks: { color: '#aaa' },
                                grid: { color: '#2a3f5f' }
                            }
                        }
                    }
                }
            );
        }

        // Subscribe to Socket.IO events
        function subscribeToEvents() {
            socket.on('metrics_update', (data) => {
                updateMetrics(data);
            });

            socket.on('participant_joined', (data) => {
                addParticipant(data);
            });

            socket.on('participant_left', (data) => {
                removeParticipant(data);
            });

            socket.on('emotion_detected', (data) => {
                updateEmotion(data);
            });

            socket.on('latency_measurement', (data) => {
                updateLatencyCharts(data);
            });

            socket.on('service_status', (data) => {
                updateServiceStatus(data);
            });
        }

        // Refresh dashboard data
        function refreshDashboard() {
            // Simulate data refresh (replace with actual API calls)
            updateSimulatedMetrics();
            updateTimestamp();
        }

        // Update simulated metrics (for demo)
        function updateSimulatedMetrics() {
            // Update latency values
            const now = new Date().toLocaleTimeString();

            // Deepgram
            const dgLatency = 220 + Math.random() * 40;
            updateChart(charts.deepgram, now, dgLatency);
            document.getElementById('deepgramLatency').textContent = Math.round(dgLatency) + 'ms';
            updateLatencyClass(document.getElementById('deepgramLatency'), dgLatency, 250);

            // DeepL
            const dlLatency = 170 + Math.random() * 40;
            updateChart(charts.deepl, now, dlLatency);
            document.getElementById('deeplLatency').textContent = Math.round(dlLatency) + 'ms';
            updateLatencyClass(document.getElementById('deeplLatency'), dlLatency, 200);

            // ElevenLabs
            const elLatency = 230 + Math.random() * 40;
            updateChart(charts.elevenlabs, now, elLatency);
            document.getElementById('elevenlabsLatency').textContent = Math.round(elLatency) + 'ms';
            updateLatencyClass(document.getElementById('elevenlabsLatency'), elLatency, 250);

            // Hume
            const hmLatency = 180 + Math.random() * 40;
            updateChart(charts.hume, now, hmLatency);
            document.getElementById('humeLatency').textContent = Math.round(hmLatency) + 'ms';
            updateLatencyClass(document.getElementById('humeLatency'), hmLatency, 200);

            // E2E
            const e2eLatency = dgLatency + dlLatency + elLatency + 180;
            updateE2EChart(now, e2eLatency);
            document.getElementById('e2eLatency').textContent = Math.round(e2eLatency) + 'ms';
            updateLatencyClass(document.getElementById('e2eLatency'), e2eLatency, 900);

            // Update latency bars
            updateLatencyBars(dgLatency, dlLatency, elLatency, hmLatency, e2eLatency);
        }

        // Update chart data
        function updateChart(chart, label, value) {
            chart.data.labels.push(label);
            chart.data.datasets[0].data.push(value);

            // Keep only last 20 data points
            if (chart.data.labels.length > 20) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }

            chart.update('none');
        }

        // Update E2E chart
        function updateE2EChart(label, value) {
            charts.e2e.data.labels.push(label);
            charts.e2e.data.datasets[0].data.push(value);
            charts.e2e.data.datasets[1].data.push(900); // Target line

            // Keep only last 20 data points
            if (charts.e2e.data.labels.length > 20) {
                charts.e2e.data.labels.shift();
                charts.e2e.data.datasets[0].data.shift();
                charts.e2e.data.datasets[1].data.shift();
            }

            charts.e2e.update('none');
        }

        // Update latency class (good/warning/critical)
        function updateLatencyClass(element, value, target) {
            element.classList.remove('good', 'warning', 'critical');
            if (value <= target) {
                element.classList.add('good');
            } else if (value <= target * 1.2) {
                element.classList.add('warning');
            } else {
                element.classList.add('critical');
            }
        }

        // Update latency breakdown bars
        function updateLatencyBars(asr, mt, tts, hume, total) {
            const asrPct = (asr / 900) * 100;
            const mtPct = (mt / 900) * 100;
            const ttsPct = (tts / 900) * 100;
            const humePct = (hume / 900) * 100;

            document.getElementById('latencyBarAsr').style.width = asrPct + '%';
            document.getElementById('latencyBarAsr').textContent = Math.round(asr) + 'ms';

            document.getElementById('latencyBarMt').style.width = mtPct + '%';
            document.getElementById('latencyBarMt').textContent = Math.round(mt) + 'ms';

            document.getElementById('latencyBarTts').style.width = ttsPct + '%';
            document.getElementById('latencyBarTts').textContent = Math.round(tts) + 'ms';

            document.getElementById('latencyBarHume').style.width = humePct + '%';
            document.getElementById('latencyBarHume').textContent = Math.round(hume) + 'ms (non-blocking)';
        }

        // Update timestamp
        function updateTimestamp() {
            document.getElementById('lastUpdate').textContent =
                'Last updated: ' + new Date().toLocaleTimeString();
        }

        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            const btn = document.getElementById('autoRefreshBtn');

            if (autoRefresh) {
                btn.textContent = '‚è∏Ô∏è Pause Auto-Refresh';
                startAutoRefresh();
            } else {
                btn.textContent = '‚ñ∂Ô∏è Resume Auto-Refresh';
                stopAutoRefresh();
            }
        }

        // Start auto-refresh
        function startAutoRefresh() {
            if (autoRefreshInterval) clearInterval(autoRefreshInterval);
            autoRefreshInterval = setInterval(refreshDashboard, 5000); // Every 5 seconds
        }

        // Stop auto-refresh
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }

        // Export metrics to CSV
        function exportMetrics() {
            const csvContent = generateMetricsCSV();
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `metrics-${Date.now()}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Generate CSV from current metrics
        function generateMetricsCSV() {
            const timestamp = new Date().toISOString();
            return `Timestamp,Service,Latency_ms,Error_Rate,Requests_Per_Min
${timestamp},Deepgram,${document.getElementById('deepgramLatency').textContent},${document.getElementById('deepgramErrors').textContent},${document.getElementById('deepgramRequests').textContent}
${timestamp},DeepL,${document.getElementById('deeplLatency').textContent},${document.getElementById('deeplErrors').textContent},-
${timestamp},ElevenLabs,${document.getElementById('elevenlabsLatency').textContent},${document.getElementById('elevenlabsErrors').textContent},${document.getElementById('elevenlabsRequests').textContent}
${timestamp},Hume,${document.getElementById('humeLatency').textContent},${document.getElementById('humeErrors').textContent},${document.getElementById('humeRequests').textContent}
${timestamp},End-to-End,${document.getElementById('e2eLatency').textContent},-,-`;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
